(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1959],{16785:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(19946).A)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]])},17548:(e,s,t)=>{"use strict";t.d(s,{BuyStakesCard:()=>E});var a=t(95155),r=t(12115);t(33109);var l=t(94870),n=t(88482),i=t(97168),c=t(37777),d=t(16785),o=t(1243),x=t(40646),m=t(51154),h=t(6874),u=t.n(h),g=t(99840),j=t(41397),N=t(49026),y=t(72258),p=t(8542),f=t(87415),v=t(1405),b=t(97868),w=t(88579),k=t(76736),C=t(99190),A=t(30383),R=t(34540);function B(e){let{isOpen:s,onClose:t,stake:l}=e,[n,c]=(0,r.useState)("confirm"),[h,B]=(0,r.useState)(!1),[P,T]=(0,r.useState)(""),[E,I]=(0,r.useState)(""),{metrics:D}=(0,y.m)(),S=(0,p.e)(),{data:F}=(0,f.G)(),J=(0,R.d4)(e=>e.balances);if(!l)return null;let V=(null==D?void 0:D.tokenPrice)||0,$=(null==D?void 0:D.currentAPY)||0,O=(0,v.J)(BigInt(l.declaredValue),18),_=async()=>{if(!F||!S){I("Wallet not connected"),c("error");return}B(!0),c("approve");try{let e=J.tokenInfos.find(e=>e.token.toLowerCase()===k.A.tokens.DRE.address.toLowerCase());if(!e)throw Error("DRE token info not found");if(BigInt(e.allowance)>=BigInt((0,b.g)(O))){c("submit"),B(!1),M();return}let{request:s}=await S.simulateContract({address:k.A.tokens.DRE.address,abi:C,functionName:"approve",args:[k.A.coreAddresses.stakingContract,w.Ao],account:F.account.address}),t=await F.writeContract(s);T(t),await S.waitForTransactionReceipt({hash:t}),c("submit"),M()}catch(e){console.error("Approval failed:",e),I("Approval failed. Please try again."),c("error")}finally{B(!1)}},M=async()=>{if(!F||!S){I("Wallet not connected"),c("error");return}B(!0),c("submit");try{let{request:e}=await S.simulateContract({address:k.A.coreAddresses.stakingContract,abi:A,functionName:"buyPosition",args:[BigInt(l.id)],account:F.account.address}),s=await F.writeContract(e);T(s),await S.waitForTransactionReceipt({hash:s}),c("success")}catch(e){console.error("Buy position failed:",e),I("Failed to buy position. Please try again."),c("error")}finally{B(!1)}},W=()=>{c("confirm"),B(!1),T(""),I(""),t()},Z=()=>{switch(n){case"confirm":case"error":default:return 0;case"approve":return 33;case"submit":return 66;case"success":return 100}},U=Number((0,v.J)(BigInt(l.declaredValue),18))/(Number((0,v.J)(BigInt(l.amount),18))+Number((0,v.J)(BigInt(l.rewards),18)))*V,H=((U-V)/V*100).toFixed(2);return(0,a.jsx)(g.lG,{open:s,onOpenChange:W,children:(0,a.jsxs)(g.Cf,{className:"sm:max-w-md bg-gray-900 border-gray-700",children:[(0,a.jsx)(g.c7,{children:(0,a.jsxs)(g.L3,{className:"flex items-center gap-2 text-white",children:[(0,a.jsx)(d.A,{className:"h-5 w-5 text-gold-400"}),"Buy Stake"]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-400",children:"Transaction Progress"}),(0,a.jsxs)("span",{className:"text-gold-400",children:[Z(),"%"]})]}),(0,a.jsx)(j.k,{value:Z(),className:"h-2 bg-gray-700",indicatorClassName:"bg-gradient-to-r from-gold-500 to-gold-600"})]}),(0,a.jsxs)("div",{className:"rounded-xl bg-gray-800/50 border border-gray-700/50 p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Stake ID"}),(0,a.jsx)("span",{className:"text-sm font-mono text-white",children:l.id})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Current Stake"}),(0,a.jsxs)("span",{className:"text-sm font-mono text-white",children:[(0,v.J)(BigInt(l.amount),18)," DRE"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Unclaimed Rewards"}),(0,a.jsxs)("span",{className:"text-sm font-mono text-white",children:[(0,v.J)(BigInt(l.rewards),18)," DRE"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Owner"}),(0,a.jsx)("span",{className:"text-sm font-mono text-white",children:(0,a.jsxs)(u(),{href:"https://sonicscan.org/address/".concat(l.owner),target:"_blank",className:"text-gold-400 hover:underline",children:[l.owner.slice(0,6),"...",l.owner.slice(-4)]})})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Current APR"}),(0,a.jsxs)("span",{className:"text-sm font-mono text-white",children:[$.toFixed(2),"%"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Predicted Rewards"}),(0,a.jsxs)("span",{className:"text-sm font-mono text-gold-400",children:[Math.floor(($/100-1)*Number((0,v.J)(BigInt(l.amount),18))).toFixed(2)," ","DRE/year"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Purchase Price"}),(0,a.jsxs)("span",{className:"text-sm font-mono text-gold-400",children:["$",U.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"DRE Required"}),(0,a.jsxs)("span",{className:"text-sm font-mono text-white",children:[(0,v.J)(BigInt(l.declaredValue),18)," DRE"," ",(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["~ $",Math.floor(Number((0,v.J)(BigInt(l.declaredValue),18))*V).toFixed(2)]})]})]})]}),"confirm"===n&&(0,a.jsxs)(N.Fc,{className:"bg-yellow-500/10 border-yellow-500/30",children:[(0,a.jsx)(o.A,{className:"h-4 w-4 text-yellow-400"}),(0,a.jsxs)(N.TN,{className:"text-gray-300",children:[(0,a.jsx)("strong",{children:"NOTE:"})," Buying this means position means you'll pay ",(0,v.J)(BigInt(l.declaredValue),18)," DRE upfront which is at a ",H,"% premium from it's current value. ",(0,a.jsx)("br",{}),(0,a.jsx)("br",{}),"But you will not have to pay any taxes and can enjoy future yields from this position. Note that yields are very volatile and this is just an estimate."]})]}),"success"===n&&(0,a.jsxs)(N.Fc,{className:"bg-green-500/10 border-green-500/30",children:[(0,a.jsx)(x.A,{className:"h-4 w-4 text-green-400"}),(0,a.jsxs)(N.TN,{className:"text-gray-300",children:[(0,a.jsx)("strong",{children:"Success!"})," You have successfully purchased this stake. The position is now yours.",(0,a.jsx)("div",{className:"mt-2 text-xs font-mono text-green-400",children:(0,a.jsx)(u(),{href:"https://sonicscan.org/tx/".concat(P),target:"_blank",className:"hover:underline",children:"View Transaction On Explorer"})})]})]}),"error"===n&&(0,a.jsxs)(N.Fc,{className:"bg-red-500/10 border-red-500/30",children:[(0,a.jsx)(o.A,{className:"h-4 w-4 text-red-400"}),(0,a.jsxs)(N.TN,{className:"text-gray-300",children:[(0,a.jsx)("strong",{children:"Error:"})," ",E]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:["confirm"===n&&(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(i.$,{variant:"outline",className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800",onClick:W,children:"Cancel"}),(0,a.jsx)(i.$,{className:"flex-1 bg-gradient-to-r from-gold-500 to-gold-600 hover:from-gold-600 hover:to-gold-700 text-black",onClick:_,children:"Start Purchase"})]})}),"approve"===n&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center space-y-2",children:[(0,a.jsx)(m.A,{className:"h-12 w-12 text-gold-400 mx-auto animate-spin"}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Approving DRE token spending..."})]}),(0,a.jsx)(i.$,{variant:"outline",className:"w-full border-gray-600 text-gray-300 hover:bg-gray-800",onClick:W,disabled:h,children:"Cancel"})]}),"submit"===n&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center space-y-2",children:[(0,a.jsx)(m.A,{className:"h-12 w-12 text-gold-400 mx-auto animate-spin"}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Purchasing stake..."})]}),(0,a.jsx)(i.$,{variant:"outline",className:"w-full border-gray-600 text-gray-300 hover:bg-gray-800",onClick:W,disabled:h,children:"Cancel"})]}),"success"===n&&(0,a.jsx)(i.$,{className:"w-full bg-gradient-to-r from-gold-500 to-gold-600 hover:from-gold-600 hover:to-gold-700 text-black",onClick:W,children:"Close"}),"error"===n&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(i.$,{variant:"outline",className:"w-full border-gray-600 text-gray-300 hover:bg-gray-800",onClick:W,children:"Close"}),(0,a.jsx)(i.$,{className:"w-full bg-gradient-to-r from-gold-500 to-gold-600 hover:from-gold-600 hover:to-gold-700 text-black",onClick:()=>c("confirm"),children:"Try Again"})]})]})]})]})})}var P=t(58281);function T(){return(0,a.jsxs)(n.Zp,{className:"glow-card bg-gray-900/50 backdrop-blur-sm",children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)("div",{className:"text-center space-y-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"How It Works"}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Understanding APR-based stake trading"})]})}),(0,a.jsx)(n.Wu,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)("span",{className:"text-xs font-bold text-green-400",children:"1"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-white",children:"APR Predictions"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Users stake with their predicted future APR"})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-gold-500/20 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)("span",{className:"text-xs font-bold text-gold-400",children:"2"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-white",children:"Value Calculation"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Stake value = (Amount \xd7 Price \xd7 Predicted APR) / Current APR"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)("span",{className:"text-xs font-bold text-blue-400",children:"3"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-white",children:"Harberger Tax"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"5% annual tax on predicted value"})]})]}),(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-red-500/20 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,a.jsx)("span",{className:"text-xs font-bold text-red-400",children:"4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-white",children:"Buy Opportunity"}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Purchase undervalued stakes at predicted value"})]})]})]})]})})]})}function E(){let[e,s]=(0,r.useState)(null),[t,d]=(0,r.useState)(!1),{allStakes:o,fetchAllStakes:x}=(0,P.B)(),{metrics:m}=(0,y.m)(),h=(0,r.useMemo)(()=>o&&0!==o.length?[...o].sort((e,s)=>(Number(e.declaredValue)-Number(e.amount))/Number(e.amount)*100-(Number(s.declaredValue)-Number(s.amount))/Number(s.amount)*100).slice(0,25):[],[o]);(0,r.useEffect)(()=>{x()},[]);let g=e=>{s(e),d(!0)};return o&&0!==o.length?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(T,{}),(0,a.jsxs)(n.Zp,{className:"glow-card bg-gray-900/50 backdrop-blur-sm",children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsx)(n.ZB,{className:"text-white",children:"Buyable Stakes"}),(0,a.jsx)(n.BT,{className:"text-gray-400",children:"Purchase stakes from other users at their predicted value"})]}),(0,a.jsx)(n.Wu,{children:(0,a.jsx)("div",{className:"space-y-4",children:h.map(e=>{var s;let t=(null!==(s=null==m?void 0:m.currentAPY)&&void 0!==s?s:0)/100,r=(t-1)*Number((0,v.J)(BigInt(e.amount),18)),n=(Number(e.declaredValue)-Number(e.amount))/Number(e.amount)*100;return(0,a.jsxs)("div",{className:"rounded-xl bg-gray-800/50 border border-gray-700/50 p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)("span",{className:"text-sm font-mono text-white",children:["Stake #",e.id]})}),(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:["Owned by"," ",(0,a.jsxs)(u(),{href:"https://sonicscan.org/address/".concat(e.owner),target:"_blank",className:"text-gold-400 hover:underline",children:[e.owner.slice(0,6),"...",e.owner.slice(-4)]})]})]}),(0,a.jsx)("div",{className:"text-right space-y-1",children:(0,a.jsxs)(i.$,{variant:"outline",size:"sm",className:"border-gray-600 text-gray-300 hover:bg-gray-800",onClick:()=>g(e),children:["Buy Stake",(0,a.jsx)(l.A,{className:"ml-1 h-4 w-4"})]})})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(c.TooltipProvider,{delayDuration:0,children:(0,a.jsxs)(c.Tooltip,{children:[(0,a.jsx)(c.TooltipTrigger,{asChild:!0,children:(0,a.jsxs)("div",{className:"space-y-1 cursor-help",children:[(0,a.jsx)("div",{className:"text-sm text-gray-400",children:"Amount + Rewards"}),(0,a.jsxs)("div",{className:"text-lg font-mono font-bold text-white",children:[(0,v.J)(BigInt(e.amount),18)," DRE"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["≈ $",(Number((0,v.J)(BigInt(e.amount+e.rewards),18))*((null==m?void 0:m.tokenPrice)||0)).toFixed(2)]})]})}),(0,a.jsx)(c.TooltipContent,{children:(0,a.jsx)("p",{className:"text-xs",children:"Total amount of DRE tokens staked in this position. This includes unclaimed rewards."})})]})}),(0,a.jsx)(c.TooltipProvider,{delayDuration:0,children:(0,a.jsxs)(c.Tooltip,{children:[(0,a.jsx)(c.TooltipTrigger,{asChild:!0,children:(0,a.jsxs)("div",{className:"space-y-1 cursor-help",children:[(0,a.jsx)("div",{className:"text-sm text-gray-400",children:"Estimated Rewards"}),(0,a.jsxs)("div",{className:"text-lg font-mono font-bold text-green-400",children:[r.toFixed(2)," DRE/year"]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["≈ $",(r*((null==m?void 0:m.tokenPrice)||0)).toFixed(2)," ","(from ",Math.floor(100*t),"% APR)"]})]})}),(0,a.jsx)(c.TooltipContent,{children:(0,a.jsx)("p",{className:"text-xs",children:"Estimated rewards for this position over the next year. This is based on the current APR and could change over time."})})]})}),(0,a.jsx)(c.TooltipProvider,{delayDuration:0,children:(0,a.jsxs)(c.Tooltip,{children:[(0,a.jsx)(c.TooltipTrigger,{asChild:!0,children:(0,a.jsxs)("div",{className:"space-y-1 cursor-help",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:[" ","Buyout Value"]}),(0,a.jsxs)("div",{className:"text-lg font-mono font-bold text-gold-400",children:[(0,v.J)(BigInt(e.declaredValue),18)," DRE"]}),(0,a.jsxs)("div",{className:"text-xs text-yellow-700",children:[n.toFixed(2),"% Premium"]})]})}),(0,a.jsx)(c.TooltipContent,{children:(0,a.jsx)("p",{className:"text-xs",children:"How much you would pay to buy this stake."})})]})})]})]},e.id)})})}),(0,a.jsx)(B,{isOpen:t,onClose:()=>{d(!1),s(null)},stake:e})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(T,{}),(0,a.jsx)(n.Zp,{className:"bg-gray-900 border-gray-700",children:(0,a.jsxs)(n.aR,{children:[(0,a.jsx)(n.ZB,{className:"text-white",children:"Buyable Stakes"}),(0,a.jsx)(n.BT,{className:"text-gray-400",children:"No stakes available for purchase"})]})})]})}},39924:(e,s,t)=>{Promise.resolve().then(t.bind(t,17548))},94870:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(19946).A)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[9751,6067,9613,6874,1823,4047,9103,8441,1684,7358],()=>s(39924)),_N_E=e.O()}]);